<!doctype html>
<html lang="ko" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover" />
  <title>ì ˆì‚­ëŸ‰ ê³„ì‚°ê¸° (6.0 / 6.5) - Offline XLSX</title>

  <style>
    /* =============================
       THEME TOKENS (Light/Dark)
       ============================= */
    :root{
      /* 125% scale baseline */
      font-size: 125%;

      --bg: #f4f6fa;
      --bg2:#eef2ff;
      --card: rgba(255,255,255,.94);
      --card2: rgba(255,255,255,.86);
      --stroke: rgba(15,23,42,.10);
      --stroke2: rgba(15,23,42,.14);
      --txt: #0f172a;
      --muted: rgba(15,23,42,.62);
      --muted2: rgba(15,23,42,.46);

      --brand: #3182f6;
      --brand2:#0ea5e9;
      --good:#10b981;
      --bad:#ef4444;

      --shadow: 0 12px 34px rgba(15,23,42,.12);
      --shadow2: 0 10px 26px rgba(15,23,42,.10);

      --radius: 18px;
      --radius2: 14px;
    }

    html[data-theme="dark"]{
      --bg: #0b1220;
      --bg2:#0f172a;
      --card: rgba(15,23,42,.72);
      --card2: rgba(15,23,42,.60);
      --stroke: rgba(255,255,255,.10);
      --stroke2: rgba(255,255,255,.14);
      --txt: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.62);
      --muted2: rgba(255,255,255,.45);

      --shadow: 0 16px 44px rgba(0,0,0,.44);
      --shadow2: 0 12px 30px rgba(0,0,0,.34);
    }

    *{box-sizing:border-box}
    html{
      min-height:100%;
      overflow-x:hidden;
      overscroll-behavior-x:none;
      background:
        radial-gradient(900px 450px at 15% 0%, rgba(49,130,246,.16), transparent 60%),
        radial-gradient(850px 480px at 85% 10%, rgba(14,165,233,.10), transparent 60%),
        linear-gradient(180deg, var(--bg2), var(--bg));
      background-attachment:scroll;
    }
    body{
      min-height:100%;
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
      color:var(--txt);
      background:transparent;
      overflow-x:hidden;
      overscroll-behavior-x:none;
    }

    .shell{
      min-height: 100%;
      padding: clamp(14px, 2.2vh, 28px) clamp(14px, 2.2vw, 22px) clamp(18px, 3vh, 34px);
      display:flex;
      justify-content:center;
    }
    .wrap{
      width: min(1180px, 100%);
      display:flex;
      flex-direction:column;
      gap: clamp(12px, 1.8vh, 18px);
    }

    .topbar{
      display:flex;
      justify-content:space-between;
      gap: 12px;
      flex-wrap:wrap;
      align-items:flex-end;
    }

    .title{
      display:flex;
      flex-direction:column;
      gap: 6px;
      min-width: 260px;
    }
    .title h1{
      margin:0;
      font-size: clamp(18px, 2.2vw, 24px);
      letter-spacing:-.4px;
      line-height:1.15;
    }
    .title p{
      margin:0;
      color:var(--muted);
      font-size: clamp(12px, 1.4vw, 13px);
      line-height:1.45;
    }

    .actions{
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .pill{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border: 1px solid var(--stroke);
      border-radius: 14px;
      background: var(--card2);
      box-shadow: var(--shadow2);
      max-width: 620px;
    }
    .dot{
      width:10px;height:10px;border-radius:999px;
      background: rgba(15,23,42,.25);
      box-shadow: 0 0 0 4px rgba(49,130,246,.10);
      flex:0 0 auto;
    }
    html[data-theme="dark"] .dot{
      background: rgba(255,255,255,.25);
    }
    .dot.ok{ background: var(--good); box-shadow: 0 0 0 4px rgba(16,185,129,.16); }
    .pilltext{display:flex;flex-direction:column;gap:2px;min-width:0}
    .pilltext .name{
      font-size: 13px;
      font-weight: 950;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
      max-width: 360px;
    }
    .pilltext .meta{
      font-size: 12px;
      color: var(--muted2);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
      max-width: 560px;
    }

    .btn{
      appearance:none;
      border: 1px solid var(--stroke2);
      background: var(--card);
      color: var(--txt);
      border-radius: 14px;
      padding: 10px 12px;
      cursor:pointer;
      font-weight: 950;
      font-size: 13px;
      box-shadow: var(--shadow2);
      transition: transform .14s ease, box-shadow .14s ease, border-color .14s ease;
      display:flex;
      gap:8px;
      align-items:center;
      user-select:none;
    }
    .btn:hover{
      transform: translateY(-1px);
      border-color: rgba(49,130,246,.35);
      box-shadow: 0 14px 30px rgba(49,130,246,.10);
    }
    .btn:active{ transform: translateY(0) scale(.99); }

    .btn.ghost{
      background: transparent;
      box-shadow:none;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap: clamp(10px, 1.6vw, 16px);
      align-items:stretch;
    }
    @media (max-width: 960px){
      .grid{ grid-template-columns: 1fr; }
      .pilltext .name{ max-width: 66vw; }
      .pilltext .meta{ max-width: 78vw; }
    }

    .card{
      border-radius: var(--radius);
      border: 1px solid var(--stroke);
      background: var(--card);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .seg{
      display:flex;
      gap: 8px;
      padding: 12px;
      border-bottom: 1px solid var(--stroke);
      background: rgba(49,130,246,.05);
    }
    html[data-theme="dark"] .seg{
      background: rgba(49,130,246,.12);
    }
    .seg button{
      flex:1;
      border: 1px solid var(--stroke);
      border-radius: 14px;
      background: rgba(255,255,255,.75);
      color: var(--muted);
      padding: 11px 10px;
      cursor:pointer;
      font-weight: 1000;
      font-size: 13px;
      transition: transform .14s ease, background .14s ease, border-color .14s ease, color .14s ease;
    }
    html[data-theme="dark"] .seg button{
      background: rgba(255,255,255,.06);
    }
    .seg button.active{
      color: #fff;
      border-color: rgba(49,130,246,.60);
      background: linear-gradient(180deg, rgba(49,130,246,.98), rgba(49,130,246,.86));
      box-shadow: 0 12px 28px rgba(49,130,246,.18);
    }
    .seg button:active{ transform: scale(.99); }

    .content{
      padding: clamp(14px, 2.2vw, 18px);
      display:grid;
      gap: 12px;
    }

    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 560px){
      .row{ grid-template-columns: 1fr; }
    }

    label{
      display:flex;
      flex-direction:column;
      gap:8px;
      font-size: 12px;
      color: var(--muted);
      font-weight: 1000;
    }

    .in{
      width:100%;
      border: 1px solid var(--stroke);
      border-radius: 14px;
      background: rgba(255,255,255,.92);
      color: var(--txt);
      padding: 12px 12px;
      font-size: 15px;
      outline:none;
      transition: border-color .14s ease, box-shadow .14s ease;
    }
    html[data-theme="dark"] .in{
      background: rgba(0,0,0,.24);
    }
    .in:focus{
      border-color: rgba(49,130,246,.65);
      box-shadow: 0 0 0 4px rgba(49,130,246,.16);
    }

    .result{
      border-radius: var(--radius);
      border: 1px solid var(--stroke);
      background: rgba(49,130,246,.05);
      padding: 16px;
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height: 176px;
      justify-content:space-between;
    }
    html[data-theme="dark"] .result{
      background: rgba(49,130,246,.10);
    }
    .result .hd{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
    }

    .badge{
      font-size: 11px;
      font-weight: 1100;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      color: var(--muted);
      background: rgba(255,255,255,.75);
      white-space:nowrap;
      align-self:flex-start;
    }
    html[data-theme="dark"] .badge{
      background: rgba(255,255,255,.06);
    }
    .badge.ok{
      color: rgba(16,185,129,.95);
      border-color: rgba(16,185,129,.35);
      background: rgba(16,185,129,.10);
    }
    .badge.bad{
      color: rgba(239,68,68,.95);
      border-color: rgba(239,68,68,.35);
      background: rgba(239,68,68,.10);
    }

    .value{
      font-size: clamp(32px, 4.8vw, 46px);
      font-weight: 1150;
      letter-spacing:-.9px;
      line-height:1.05;
      display:flex;
      gap:10px;
      align-items:baseline;
    }

    .hint{
      font-size: 12px;
      color: var(--muted);
      line-height:1.5;
    }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace; }

    .favwrap{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top: 4px;
    }
    .favtitle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      font-size: 12px;
      color: var(--muted);
      font-weight: 1100;
      flex-wrap:wrap;
    }
    .favgrid{
      display:grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap: 10px;
    }
    @media (max-width: 780px){
      .favgrid{ grid-template-columns: repeat(3, minmax(0, 1fr)); }
    }
    @media (max-width: 460px){
      .favgrid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }

    .fav{
      border-radius: 14px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.92);
      padding: 10px 10px;
      cursor:pointer;
      transition: transform .14s ease, border-color .14s ease, box-shadow .14s ease;
      min-height: 66px;
      display:flex;
      flex-direction:column;
      gap:6px;
      justify-content:center;
      box-shadow: 0 8px 18px rgba(15,23,42,.06);
    }
    html[data-theme="dark"] .fav{
      background: rgba(0,0,0,.22);
      box-shadow: 0 10px 22px rgba(0,0,0,.26);
    }
    .fav:hover{
      transform: translateY(-1px);
      border-color: rgba(49,130,246,.35);
      box-shadow: 0 12px 26px rgba(49,130,246,.10);
    }
    .fav .t{
      font-size: 12px;
      font-weight: 1150;
      color: var(--txt);
      line-height:1.2;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .fav .s{
      font-size: 11px;
      color: var(--muted2);
      font-weight: 950;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .fav{
      position:relative;
    }
    .fav-del{
      position:absolute;
      top:6px;
      right:6px;
      width:20px;
      height:20px;
      border:none;
      border-radius:50%;
      background:rgba(239,68,68,.15);
      color:rgba(239,68,68,.9);
      font-size:11px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      opacity:0;
      transition:opacity .14s ease, background .14s ease;
    }
    .fav:hover .fav-del{
      opacity:1;
    }
    .fav-del:hover{
      background:rgba(239,68,68,.25);
    }
    .fav.empty{
      cursor:default;
      opacity:.60;
      background: rgba(255,255,255,.70);
      box-shadow:none;
    }
    html[data-theme="dark"] .fav.empty{
      background: rgba(255,255,255,.06);
    }
    .fav.empty:hover{ transform:none; border-color: var(--stroke); box-shadow:none; }

    .sideblock{display:flex;flex-direction:column;gap: 14px;}
    .sidebox{
      border-radius: var(--radius);
      border: 1px solid var(--stroke);
      background: var(--card);
      box-shadow: var(--shadow);
      padding: 16px;
      display:flex;
      flex-direction:column;
      gap: 10px;
    }
    .sidebox h3{
      margin:0;
      font-size: 13px;
      letter-spacing:-.2px;
      font-weight: 1150;
    }
    .sidebox .small{
      font-size: 12px;
      color: var(--muted);
      line-height:1.55;
    }

    .toast{
      position:fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: rgba(15,23,42,.92);
      color: white;
      padding: 10px 12px;
      border-radius: 14px;
      box-shadow: 0 12px 28px rgba(0,0,0,.22);
      font-size: 12px;
      font-weight: 950;
      opacity:0;
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
      z-index: 9999;
      max-width: min(92vw, 740px);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .toast.show{
      opacity:1;
      transform: translateX(-50%) translateY(-2px);
    }

    /* tighter buttons row on small screens */
    @media (max-width: 520px){
      .actions{ justify-content:flex-start; }
      .pill{ width: 100%; max-width: none; }
      .btn{ flex:1; justify-content:center; }
    }
  </style>
</head>

<body>
  <div class="shell">
    <div class="wrap">
      <div class="topbar">
        <div class="title">
          <h1>ì ˆì‚­ëŸ‰ ê³„ì‚°ê¸° <span class="mono" style="opacity:.75">(6.0 / 6.5)</span></h1>
          <p>
            ì—‘ì…€ ê³µì‹ ê·¸ëŒ€ë¡œ: <span class="mono">ì”ì—¬ = ë‘ê»˜ âˆ’ í‘œì¡°íšŒ âˆ’ 100</span><br/>
            ê³„ì‚°ì€ <b>0.01 ë‹¨ìœ„ ì •ìˆ˜í™”</b>ë¡œ ì²˜ë¦¬í•´ í‘œì‹œ/ì—°ì‚° ì˜¤ì°¨ë¥¼ ì œê±°í•©ë‹ˆë‹¤.
          </p>
        </div>

        <div class="actions">
          <div class="pill" title="ì—‘ì…€(xlsx)ì„ ì—…ë¡œë“œí•˜ë©´ ë‚´ë¶€ í‘œë¥¼ íŒŒì‹±í•©ë‹ˆë‹¤.">
            <div id="fileDot" class="dot"></div>
            <div class="pilltext">
              <div id="fileName" class="name">ì—‘ì…€ ë¯¸ë¡œë“œ</div>
              <div id="fileMeta" class="meta">xlsx ì—…ë¡œë“œë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘â€¦</div>
            </div>
          </div>

          <button class="btn" id="themeBtn" type="button" aria-label="ë‹¤í¬/ë¼ì´íŠ¸ ëª¨ë“œ ì „í™˜">
            <span id="themeIcon">ğŸŒ™</span><span id="themeText">ë‹¤í¬</span>
          </button>

          <button class="btn" id="pickBtn" type="button" aria-label="ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ">
            <span>ğŸ“„</span><span>ì—‘ì…€ ì—…ë¡œë“œ</span>
          </button>

          <button class="btn" id="clearBtn" type="button" aria-label="ì…ë ¥ê°’ ì „ì²´ ì´ˆê¸°í™”">
            <span>ğŸ§½</span><span>Clear</span>
          </button>

          <input id="fileInput" type="file" accept=".xlsx" style="position:absolute;left:-9999px;width:1px;height:1px;opacity:0;" />
        </div>
      </div>

      <div class="grid">
        <!-- Main -->
        <div class="card">
          <div class="seg">
            <button id="tab60" type="button">6.0mm</button>
            <button id="tab65" class="active" type="button">6.5mm</button>
          </div>

          <div class="content">
            <div class="row">
              <label>
                Sphere (sph)
                <input id="inpSph" class="in" placeholder="ì˜ˆ: -3.00" autocomplete="off" />
              </label>

              <label>
                Cylinder (cyl)
                <input id="inpCyl" class="in" placeholder="ì˜ˆ: -1.00" autocomplete="off" />
              </label>
            </div>

            <div class="row">
              <label>
                ë‘ê»˜
                <input id="inpThk" class="in" inputmode="decimal" placeholder="ì˜ˆ: 550" autocomplete="off" />
              </label>

              <div class="result">
                <div class="hd">
                  <div style="display:flex;flex-direction:column;gap:4px;">
                    <div style="font-size:12px;color:var(--muted);font-weight:1150;">ê²°ê³¼ (ì”ì—¬)</div>
                    <div id="formulaLine" class="mono" style="font-size:11px;color:var(--muted2);font-weight:900;">
                      6.5mm: ë‘ê»˜ âˆ’ WFO6.5 âˆ’ 100
                    </div>
                  </div>
                  <span id="statusBadge" class="badge">N/A</span>
                </div>

                <div class="value">
                  <span id="outVal">N/A</span>
                </div>

                <div class="hint" id="hintLine">
                  ì—‘ì…€ì„ ì—…ë¡œë“œí•œ ë’¤ sph/cyl/ë‘ê»˜ë¥¼ ì…ë ¥í•˜ë©´ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.
                </div>
              </div>
            </div>

            <div class="favwrap">
              <div class="favtitle">
                <span>ì¦ê²¨ì°¾ê¸° (ìµœëŒ€ 5ê°œ)</span>
                <div style="display:flex;gap:6px;">
                  <button class="btn ghost" id="addFavBtn" type="button" style="padding:8px 10px;border-radius:12px;font-size:12px;">
                    â­ ë“±ë¡
                  </button>
                  <button class="btn ghost" id="clearFavBtn" type="button" style="padding:8px 10px;border-radius:12px;font-size:12px;">
                    ğŸ§¹ ì‚­ì œ
                  </button>
                </div>
              </div>
              <div class="favgrid" id="favGrid"></div>
            </div>
          </div>
        </div>

        <!-- Side -->
        <div class="sideblock">
          <div class="sidebox">
            <h3>ë™ì‘ ê·œì¹™</h3>
            <div class="small">
              â€¢ <b class="mono">WFO 6mm</b> / <b class="mono">WFO 6.5mm</b> ì‹œíŠ¸ì—ì„œ sph(í–‰), cyl(ì—´)ì„ <b>ì •í™•íˆ ë§¤ì¹­</b>í•©ë‹ˆë‹¤.<br/>
              â€¢ í•´ë‹¹ êµì°¨ê°’ì´ â€œ-â€ì´ê±°ë‚˜ ë¹„ì–´ ìˆìœ¼ë©´ <b>N/A</b>ê°€ ì •ìƒì…ë‹ˆë‹¤.<br/>
              â€¢ ìœ íš¨í•˜ë©´ ì¦‰ì‹œ: <b class="mono">ë‘ê»˜ âˆ’ ì¡°íšŒê°’ âˆ’ 100</b>
            </div>
          </div>

          <div class="sidebox">
            <h3>ë¸Œë¼ìš°ì € ìš”êµ¬ì‚¬í•­</h3>
            <div class="small">
              ì´ í˜ì´ì§€ëŠ” ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ì´ <b>xlsx(zip+deflate)</b>ë¥¼ í’€ê¸° ìœ„í•´
              <span class="mono">DecompressionStream</span>ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.<br/>
              Chrome/Edge ê¶Œì¥. ì§€ì›ì´ ì—†ìœ¼ë©´ ì•ˆë‚´ ë©”ì‹œì§€ê°€ ëœ¹ë‹ˆë‹¤.
            </div>
          </div>

          <div class="sidebox">
            <h3>ì˜¤ì°¨ ì œê±°</h3>
            <div class="small">
              ë¶€ë™ì†Œìˆ˜ì  ì˜¤ì°¨ë¥¼ ë§‰ê¸° ìœ„í•´, ë‘ê»˜/ì¡°íšŒê°’ì„ <b>Ã—100 ì •ìˆ˜(0.01ë‹¨ìœ„)</b>ë¡œ ë°”ê¿” ê³„ì‚° í›„ ë‹¤ì‹œ í‘œì‹œí•©ë‹ˆë‹¤.
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    /******************************************************************
     * XLSX Offline Reader (No external libraries)
     * - Parses ZIP central directory
     * - Inflates DEFLATE entries using DecompressionStream('deflate-raw')
     * - Reads:
     *    xl/workbook.xml
     *    xl/_rels/workbook.xml.rels
     *    xl/sharedStrings.xml (optional)
     *    xl/worksheets/*.xml
     *
     * Then extracts:
     *   "WFO 6mm", "WFO 6.5mm"
     *   ranges: sph A3:A51, cyl B2:Z2, data B3:Z51
     *
     * EXACT formula:
     *   residual = thickness - lookup - 100
     * using centi-integers to eliminate float error.
     ******************************************************************/

    const SHEET_60 = "WFO 6mm";
    const SHEET_65 = "WFO 6.5mm";

    const R_SPH_START = 3, R_SPH_END = 51;
    const C_CYL_START = 2, C_CYL_END = 26;

    const OFFSET = 100;

    const ui = {
      tab60: document.getElementById("tab60"),
      tab65: document.getElementById("tab65"),
      inpSph: document.getElementById("inpSph"),
      inpCyl: document.getElementById("inpCyl"),
      inpThk: document.getElementById("inpThk"),
      outVal: document.getElementById("outVal"),
      statusBadge: document.getElementById("statusBadge"),
      hintLine: document.getElementById("hintLine"),
      formulaLine: document.getElementById("formulaLine"),

      fileDot: document.getElementById("fileDot"),
      fileName: document.getElementById("fileName"),
      fileMeta: document.getElementById("fileMeta"),

      pickBtn: document.getElementById("pickBtn"),
      fileInput: document.getElementById("fileInput"),
      clearBtn: document.getElementById("clearBtn"),

      themeBtn: document.getElementById("themeBtn"),
      themeIcon: document.getElementById("themeIcon"),
      themeText: document.getElementById("themeText"),

      favGrid: document.getElementById("favGrid"),
      addFavBtn: document.getElementById("addFavBtn"),
      clearFavBtn: document.getElementById("clearFavBtn"),

      toast: document.getElementById("toast"),
    };

    let mode = "6.5"; // "6.0" or "6.5"

    const tables = { "6.0": null, "6.5": null }; // {sphList,cylList,valueMap}
    const FAV_KEY = "wfo_calc_favs_offline_v1";
    const THEME_KEY = "wfo_calc_theme_v1";

    function toast(msg){
      ui.toast.textContent = msg;
      ui.toast.classList.add("show");
      clearTimeout(toast._t);
      toast._t = setTimeout(()=>ui.toast.classList.remove("show"), 1700);
    }

    function setFileStatus(ok, name, meta){
      ui.fileDot.classList.toggle("ok", !!ok);
      ui.fileName.textContent = name || (ok ? "ì—‘ì…€ ë¡œë“œë¨" : "ì—‘ì…€ ë¯¸ë¡œë“œ");
      ui.fileMeta.textContent = meta || "";
    }

    function badgeNA(){
      ui.statusBadge.textContent = "N/A";
      ui.statusBadge.classList.remove("ok","bad");
      ui.outVal.textContent = "N/A";
    }
    function badgeOK(){
      ui.statusBadge.textContent = "OK";
      ui.statusBadge.classList.add("ok");
      ui.statusBadge.classList.remove("bad");
    }
    function badgeBAD(){
      ui.statusBadge.textContent = "N/A";
      ui.statusBadge.classList.add("bad");
      ui.statusBadge.classList.remove("ok");
    }

    function setMode(next){
      mode = next;
      ui.tab60.classList.toggle("active", mode==="6.0");
      ui.tab65.classList.toggle("active", mode==="6.5");
      ui.formulaLine.textContent = (mode==="6.0")
        ? "6.0mm: ë‘ê»˜ âˆ’ WFO6 âˆ’ 100"
        : "6.5mm: ë‘ê»˜ âˆ’ WFO6.5 âˆ’ 100";
      renderFavorites();
      computeAndRender();
    }
    ui.tab60.addEventListener("click", ()=>setMode("6.0"));
    ui.tab65.addEventListener("click", ()=>setMode("6.5"));

    // =============================
    // Theme toggle
    // =============================
    function applyTheme(theme){
      document.documentElement.setAttribute("data-theme", theme);
      localStorage.setItem(THEME_KEY, theme);
      const isDark = theme === "dark";
      ui.themeIcon.textContent = isDark ? "â˜€ï¸" : "ğŸŒ™";
      ui.themeText.textContent = isDark ? "ë¼ì´íŠ¸" : "ë‹¤í¬";
    }
    ui.themeBtn.addEventListener("click", ()=>{
      const cur = document.documentElement.getAttribute("data-theme") || "light";
      applyTheme(cur === "dark" ? "light" : "dark");
    });

    // =============================
    // Float error removal (centi units)
    // =============================
    function toCenti(n){ return Math.round(n * 100); }
    function fromCenti(x){ return x / 100; }
    function fmt2(n){
      if (!Number.isFinite(n)) return "N/A";
      const s = n.toFixed(2);
      return s.replace(/\.00$/, "").replace(/(\.\d)0$/, "$1");
    }
    function numOrNaN(v){
      if (v === null || v === undefined) return NaN;
      if (typeof v === "number") return v;
      const s = String(v).trim();
      if (!s) return NaN;
      const n = Number(s);
      return Number.isFinite(n) ? n : NaN;
    }
    function toKey(sph, cyl){ return `${sph}|${cyl}`; }

    // =============================
    // Favorites (ìˆ˜ë™ ë“±ë¡ ë°©ì‹)
    // =============================
    function loadFavStore(){
      try{
        const raw = localStorage.getItem(FAV_KEY);
        if (!raw) return { "6.0": [], "6.5": [] };
        const obj = JSON.parse(raw);
        // ë°°ì—´ í˜•íƒœë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜
        if (!Array.isArray(obj["6.0"])) obj["6.0"] = [];
        if (!Array.isArray(obj["6.5"])) obj["6.5"] = [];
        return obj;
      }catch(_e){
        return { "6.0": [], "6.5": [] };
      }
    }
    function saveFavStore(store){
      localStorage.setItem(FAV_KEY, JSON.stringify(store));
    }
    function addFavorite(){
      const sph = ui.inpSph.value.trim();
      const cyl = ui.inpCyl.value.trim();
      const thk = ui.inpThk.value.trim();
      if (!sph || !cyl || !thk){
        toast("sph, cyl, ë‘ê»˜ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”");
        return;
      }

      const store = loadFavStore();
      const k = `${sph}|${cyl}|${thk}`;
      
      // ì´ë¯¸ ì¡´ì¬í•˜ë©´ ì œê±° í›„ ë§¨ ì•ì— ì¶”ê°€
      const idx = store[mode].indexOf(k);
      if (idx !== -1) store[mode].splice(idx, 1);
      
      // ë§¨ ì•ì— ì¶”ê°€
      store[mode].unshift(k);
      
      // ìµœëŒ€ 5ê°œ ìœ ì§€
      if (store[mode].length > 5) store[mode] = store[mode].slice(0, 5);
      
      saveFavStore(store);
      renderFavorites();
      toast("ì¦ê²¨ì°¾ê¸°ì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤");
    }
    function removeFavorite(index){
      const store = loadFavStore();
      store[mode].splice(index, 1);
      saveFavStore(store);
      renderFavorites();
      toast("ì¦ê²¨ì°¾ê¸°ì—ì„œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤");
    }
    function getFavorites(){
      const store = loadFavStore();
      return (store[mode] || []).map(k => {
        const [sph, cyl, thk] = k.split("|");
        return { sph, cyl, thk };
      });
    }
    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
        .replaceAll('"',"&quot;").replaceAll("'","&#039;");
    }
    function renderFavorites(){
      ui.favGrid.innerHTML = "";
      const favs = getFavorites();
      const slots = 5;

      for (let i=0;i<slots;i++){
        const f = favs[i];
        const el = document.createElement("div");
        el.className = "fav" + (f ? "" : " empty");

        if (!f){
          el.innerHTML = `<div class="t">ë¹ˆ ìŠ¬ë¡¯</div><div class="s">â­ ë²„íŠ¼ìœ¼ë¡œ ë“±ë¡í•˜ì„¸ìš”</div>`;
          ui.favGrid.appendChild(el);
          continue;
        }

        el.innerHTML = `
          <div class="t">sph ${escapeHtml(f.sph)} / cyl ${escapeHtml(f.cyl)}</div>
          <div class="s">ë‘ê»˜ ${escapeHtml(f.thk)}</div>
          <button class="fav-del" data-idx="${i}" type="button" title="ì‚­ì œ">âœ•</button>
        `;
        el.addEventListener("click", (e)=>{
          if (e.target.classList.contains("fav-del")) return;
          ui.inpSph.value = f.sph;
          ui.inpCyl.value = f.cyl;
          ui.inpThk.value = f.thk;
          computeAndRender();
        });
        el.querySelector(".fav-del").addEventListener("click", (e)=>{
          e.stopPropagation();
          removeFavorite(i);
        });
        ui.favGrid.appendChild(el);
      }
    }
    ui.addFavBtn.addEventListener("click", addFavorite);
    ui.clearFavBtn.addEventListener("click", ()=>{
      const store = loadFavStore();
      store[mode] = [];
      saveFavStore(store);
      renderFavorites();
      toast("ì¦ê²¨ì°¾ê¸°ë¥¼ ëª¨ë‘ ì‚­ì œí–ˆìŠµë‹ˆë‹¤");
    });

    // =============================
    // Clear all inputs button
    // =============================
    ui.clearBtn.addEventListener("click", ()=>{
      ui.inpSph.value = "";
      ui.inpCyl.value = "";
      ui.inpThk.value = "";
      badgeNA();
      ui.hintLine.textContent = "ì…ë ¥ê°’ì„ ëª¨ë‘ ì´ˆê¸°í™”í–ˆìŠµë‹ˆë‹¤.";
      toast("Clear ì™„ë£Œ");
    });

    function findExactInList(list, input){
      const n = numOrNaN(input);
      if (!Number.isFinite(n)) return null;
      // ë¶€ë™ì†Œìˆ˜ì  ë¹„êµ: 0.001 ì´ë‚´ë©´ ë™ì¼ê°’ìœ¼ë¡œ ê°„ì£¼
      const EPS = 0.001;
      for (const v of list){
        if (Math.abs(v - n) < EPS) return v;
      }
      return null;
    }

    // =============================
    // Compute
    // =============================
    function computeAndRender(){
      const t = tables[mode];
      if (!t){
        badgeNA();
        ui.hintLine.textContent = "ì—‘ì…€ì„ ì—…ë¡œë“œí•˜ë©´ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.";
        renderFavorites();
        return;
      }

      const sphIn = ui.inpSph.value.trim();
      const cylIn = ui.inpCyl.value.trim();
      const thkIn = ui.inpThk.value.trim();

      if (!sphIn || !cylIn || !thkIn){
        badgeNA();
        ui.hintLine.textContent = "sph / cyl / ë‘ê»˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.";
        return;
      }

      const sph = findExactInList(t.sphList, sphIn);
      const cyl = findExactInList(t.cylList, cylIn);
      const thk = numOrNaN(thkIn);

      if (sph === null || cyl === null || !Number.isFinite(thk)){
        badgeBAD();
        ui.outVal.textContent = "N/A";
        ui.hintLine.textContent = "í‘œì— ìˆëŠ” ì •í™•í•œ sph/cyl ê°’ + ìˆ«ì ë‘ê»˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.";
        return;
      }

      const lookup = t.valueMap.get(toKey(sph, cyl));
      if (lookup === null || lookup === undefined){
        badgeBAD();
        ui.outVal.textContent = "N/A";
        ui.hintLine.textContent = "í•´ë‹¹ sph/cyl ì¡°í•©ì˜ í‘œ ê°’ì´ '-'ì´ê±°ë‚˜ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.";
        return;
      }

      // exact math in centi-units:
      const thkC = toCenti(thk);
      const lookC = toCenti(lookup);
      const resC = thkC - lookC - OFFSET * 100;
      const res = fromCenti(resC);

      badgeOK();
      ui.outVal.textContent = fmt2(res);
      ui.hintLine.textContent =
        `ì¡°íšŒê°’=${fmt2(lookup)} â†’ ${fmt2(thk)} âˆ’ ${fmt2(lookup)} âˆ’ ${OFFSET} = ${fmt2(res)}`;
    }

    ["input","change","keyup"].forEach(ev=>{
      ui.inpSph.addEventListener(ev, computeAndRender);
      ui.inpCyl.addEventListener(ev, computeAndRender);
      ui.inpThk.addEventListener(ev, computeAndRender);
    });

    // =============================
    // XLSX Reader (ZIP + XML)
    // =============================

    // --- A1 helpers ---
    function colToNumber(col){
      // A -> 1
      let n = 0;
      for (let i=0;i<col.length;i++){
        const c = col.charCodeAt(i);
        n = n*26 + (c - 64);
      }
      return n;
    }

    // --- ZIP parsing (central directory) ---
    function u16(dv, o){ return dv.getUint16(o, true); }
    function u32(dv, o){ return dv.getUint32(o, true); }

    function findEOCD(buf){
      // EOCD signature 0x06054b50
      const dv = new DataView(buf);
      for (let i = buf.byteLength - 22; i >= Math.max(0, buf.byteLength - 0x10000); i--){
        if (dv.getUint32(i, true) === 0x06054b50) return i;
      }
      return -1;
    }

    function parseCentralDirectory(buf){
      const dv = new DataView(buf);
      const eocd = findEOCD(buf);
      if (eocd < 0) throw new Error("ZIP EOCDë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (xlsxê°€ ì†ìƒëì„ ìˆ˜ ìˆìŒ)");

      const cdSize = u32(dv, eocd + 12);
      const cdOff  = u32(dv, eocd + 16);

      let off = cdOff;
      const files = new Map();

      while (off < cdOff + cdSize){
        const sig = dv.getUint32(off, true);
        if (sig !== 0x02014b50) break;

        const compMethod = u16(dv, off + 10);
        const compSize   = u32(dv, off + 20);
        const uncompSize = u32(dv, off + 24);
        const nameLen    = u16(dv, off + 28);
        const extraLen   = u16(dv, off + 30);
        const cmtLen     = u16(dv, off + 32);
        const lfhOff     = u32(dv, off + 42);

        const nameBytes = new Uint8Array(buf, off + 46, nameLen);
        const name = new TextDecoder("utf-8").decode(nameBytes);

        files.set(name, { compMethod, compSize, uncompSize, lfhOff });

        off = off + 46 + nameLen + extraLen + cmtLen;
      }
      return files;
    }

    function readLocalFileEntry(buf, entry){
      const dv = new DataView(buf);
      const off = entry.lfhOff;
      if (dv.getUint32(off, true) !== 0x04034b50) {
        throw new Error("ZIP Local File Headerê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
      }
      const nameLen  = u16(dv, off + 26);
      const extraLen = u16(dv, off + 28);
      const dataOff  = off + 30 + nameLen + extraLen;
      const compData = new Uint8Array(buf, dataOff, entry.compSize);
      return { compData };
    }

    async function inflateIfNeeded(compMethod, compData){
      if (compMethod === 0) {
        return compData; // stored
      }
      if (compMethod !== 8) {
        throw new Error("ì§€ì›í•˜ì§€ ì•ŠëŠ” ZIP ì••ì¶• ë°©ì‹ì…ë‹ˆë‹¤: " + compMethod);
      }
      if (typeof DecompressionStream === "undefined") {
        throw new Error("ì´ ë¸Œë¼ìš°ì €ëŠ” DecompressionStreamì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. (Chrome/Edge ê¶Œì¥)");
      }
      const ds = new DecompressionStream("deflate-raw");
      const stream = new Blob([compData]).stream().pipeThrough(ds);
      const ab = await new Response(stream).arrayBuffer();
      return new Uint8Array(ab);
    }

    async function getZipTextFile(buf, files, path){
      const entry = files.get(path);
      if (!entry) return null;
      const { compData } = readLocalFileEntry(buf, entry);
      const data = await inflateIfNeeded(entry.compMethod, compData);
      return new TextDecoder("utf-8").decode(data);
    }

    function parseXml(text){
      const doc = new DOMParser().parseFromString(text, "application/xml");
      const pe = doc.getElementsByTagName("parsererror")[0];
      if (pe) throw new Error("XML íŒŒì‹± ì˜¤ë¥˜: " + pe.textContent);
      return doc;
    }

    function getSharedStrings(doc){
      // sharedStrings.xml: <sst><si>...</si></sst>
      const sst = doc.getElementsByTagName("sst")[0];
      if (!sst) return [];
      const sis = Array.from(sst.getElementsByTagName("si"));
      const out = new Array(sis.length);
      for (let i=0;i<sis.length;i++){
        const si = sis[i];
        // Can be <t> or rich <r><t>
        const ts = si.getElementsByTagName("t");
        let s = "";
        for (const t of Array.from(ts)){
          s += t.textContent ?? "";
        }
        out[i] = s;
      }
      return out;
    }

    function buildWorkbookSheetMap(workbookDoc, relsDoc){
      // workbook.xml: <sheets><sheet name="" r:id="rId1" />
      const sheetsEl = workbookDoc.getElementsByTagName("sheets")[0];
      if (!sheetsEl) throw new Error("workbook.xmlì—ì„œ sheetsë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");

      const relMap = new Map();
      // workbook.xml.rels: <Relationship Id="rId1" Target="worksheets/sheet1.xml" />
      const rels = Array.from(relsDoc.getElementsByTagName("Relationship"));
      for (const r of rels){
        const id = r.getAttribute("Id");
        const target = r.getAttribute("Target");
        if (id && target) relMap.set(id, "xl/" + target.replace(/^\//,""));
      }

      const sheetNodes = Array.from(sheetsEl.getElementsByTagName("sheet"));
      const map = new Map(); // sheetName -> worksheetPath
      for (const s of sheetNodes){
        const name = s.getAttribute("name");
        const rid = s.getAttribute("r:id");
        if (!name || !rid) continue;
        const path = relMap.get(rid);
        if (path) map.set(name, path);
      }
      return map;
    }

    function buildCellMap(sheetDoc, sharedStrings){
      // Build Map<A1, value> from <sheetData><row><c r="A1" t="s"><v>0</v></c>
      const map = new Map();
      const cells = Array.from(sheetDoc.getElementsByTagName("c"));
      for (const c of cells){
        const ref = c.getAttribute("r");
        if (!ref) continue;

        const t = c.getAttribute("t"); // "s" for shared string
        const vEl = c.getElementsByTagName("v")[0];
        const isEl = c.getElementsByTagName("is")[0]; // inline string sometimes

        let value = undefined;

        if (t === "s"){
          if (!vEl) continue;
          const idx = parseInt(vEl.textContent || "", 10);
          value = sharedStrings[idx] ?? "";
        } else if (t === "inlineStr"){
          if (isEl) value = isEl.textContent ?? "";
        } else {
          if (!vEl) continue;
          const raw = (vEl.textContent || "").trim();
          // treat as number if numeric
          const n = Number(raw);
          value = Number.isFinite(n) ? n : raw;
        }

        map.set(ref, value);
      }
      return map;
    }

    function extractTableFromCellMap(cellMap){
      // sph A3:A51
      const sphList = [];
      for (let r=R_SPH_START; r<=R_SPH_END; r++){
        const v = cellMap.get(`A${r}`);
        const n = numOrNaN(v);
        if (!Number.isFinite(n)) throw new Error("sph ë²”ìœ„(A3:A51)ì—ì„œ ìˆ«ì íŒŒì‹± ì‹¤íŒ¨: A" + r);
        sphList.push(n);
      }

      // cyl B2:Z2 => columns 2..26
      const cylList = [];
      for (let c=C_CYL_START; c<=C_CYL_END; c++){
        const col = numberToCol(c);
        let v = cellMap.get(`${col}2`);
        if (typeof v === "string") v = v.trim();
        const n = numOrNaN(v);
        if (!Number.isFinite(n)) throw new Error("cyl ë²”ìœ„(B2:Z2)ì—ì„œ ìˆ«ì íŒŒì‹± ì‹¤íŒ¨: " + col + "2");
        cylList.push(n);
      }

      // data B3:Z51
      const valueMap = new Map();
      for (let i=0;i<sphList.length;i++){
        for (let j=0;j<cylList.length;j++){
          const r = R_SPH_START + i;
          const c = C_CYL_START + j;
          const col = numberToCol(c);
          let v = cellMap.get(`${col}${r}`);

          if (typeof v === "string"){
            const s = v.trim();
            if (s === "-" || s === "") v = undefined;
          }

          const n = numOrNaN(v);
          const val = Number.isFinite(n) ? n : null;
          valueMap.set(toKey(sphList[i], cylList[j]), val);
        }
      }

      return { sphList, cylList, valueMap };
    }

    function numberToCol(n){
      // 1->A
      let s = "";
      while (n > 0){
        const r = (n - 1) % 26;
        s = String.fromCharCode(65 + r) + s;
        n = Math.floor((n - 1) / 26);
      }
      return s;
    }

    async function parseXlsx(arrayBuffer){
      const buf = arrayBuffer;
      const files = parseCentralDirectory(buf);

      const workbookXml = await getZipTextFile(buf, files, "xl/workbook.xml");
      const relsXml     = await getZipTextFile(buf, files, "xl/_rels/workbook.xml.rels");
      if (!workbookXml || !relsXml) throw new Error("workbook.xml ë˜ëŠ” workbook.xml.relsë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");

      const sharedXml   = await getZipTextFile(buf, files, "xl/sharedStrings.xml");
      const sharedStrings = sharedXml ? getSharedStrings(parseXml(sharedXml)) : [];

      const wbDoc = parseXml(workbookXml);
      const relDoc = parseXml(relsXml);
      const sheetMap = buildWorkbookSheetMap(wbDoc, relDoc);

      const path60 = sheetMap.get(SHEET_60);
      const path65 = sheetMap.get(SHEET_65);
      if (!path60 || !path65){
        const names = Array.from(sheetMap.keys()).join(", ");
        throw new Error(`í•„ìˆ˜ ì‹œíŠ¸("${SHEET_60}", "${SHEET_65}")ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (ë°œê²¬ëœ ì‹œíŠ¸: ${names})`);
      }

      const sheet60Xml = await getZipTextFile(buf, files, path60);
      const sheet65Xml = await getZipTextFile(buf, files, path65);
      if (!sheet60Xml || !sheet65Xml) throw new Error("ì›Œí¬ì‹œíŠ¸ XMLì„ ì½ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");

      const s60Doc = parseXml(sheet60Xml);
      const s65Doc = parseXml(sheet65Xml);

      const cell60 = buildCellMap(s60Doc, sharedStrings);
      const cell65 = buildCellMap(s65Doc, sharedStrings);

      const t60 = extractTableFromCellMap(cell60);
      const t65 = extractTableFromCellMap(cell65);

      return { t60, t65 };
    }

    // =============================
    // File upload
    // =============================
    ui.pickBtn.addEventListener("click", ()=>{
      ui.fileInput.value = ""; // allow re-upload same file
      ui.fileInput.click();
    });

    ui.fileInput.addEventListener("change", async (e)=>{
      const f = e.target.files && e.target.files[0];
      if (!f) return;

      if (!/\.xlsx$/i.test(f.name)){
        toast("xlsx íŒŒì¼ë§Œ ì§€ì›í•©ë‹ˆë‹¤.");
        return;
      }

      setFileStatus(false, "ë¡œë”© ì¤‘â€¦", "xlsxë¥¼ íŒŒì‹±í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì ì‹œë§Œâ€¦");

      try{
        const buf = await f.arrayBuffer();
        const { t60, t65 } = await parseXlsx(buf);

        tables["6.0"] = t60;
        tables["6.5"] = t65;

        setFileStatus(true, f.name, `ì‹œíŠ¸ "${SHEET_60}", "${SHEET_65}" Â· sph ${t60.sphList.length} Â· cyl ${t60.cylList.length}`);
        toast("ì—‘ì…€ ë¡œë“œ ì™„ë£Œ");

        computeAndRender();
      }catch(err){
        console.error(err);
        tables["6.0"] = null;
        tables["6.5"] = null;

        setFileStatus(false, "ì—‘ì…€ ë¡œë“œ ì‹¤íŒ¨", String(err.message || err));
        badgeNA();
        ui.hintLine.textContent = "ì—‘ì…€ì„ ë‹¤ì‹œ ì—…ë¡œë“œí•´ ì£¼ì„¸ìš”.";
        toast("ì—‘ì…€ ë¡œë“œ ì‹¤íŒ¨");
      }
    });

    // =============================
    // Init
    // =============================
    (function init(){
      // theme
      const savedTheme = localStorage.getItem(THEME_KEY);
      if (savedTheme === "dark" || savedTheme === "light"){
        applyTheme(savedTheme);
      } else {
        // default: system preference
        const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
        applyTheme(prefersDark ? "dark" : "light");
      }

      // initial mode
      setMode("6.5");

      // initial favorites + UI
      renderFavorites();
      badgeNA();

      // capability check
      if (typeof DecompressionStream === "undefined"){
        setFileStatus(false, "ë¸Œë¼ìš°ì € ë¯¸ì§€ì›", "DecompressionStream ë¯¸ì§€ì›: Chrome/Edge ê¶Œì¥");
        ui.hintLine.textContent = "ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” xlsx(zip) í•´ì œê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. Chrome/Edgeë¡œ ì—´ì–´ì£¼ì„¸ìš”.";
      } else {
        loadBundledXlsx();
      }
    })();

    async function loadBundledXlsx() {
  try {
    setFileStatus(false, "ë¡œë”© ì¤‘â€¦", "ì„œë²„ì˜ data.xlsxë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘");

    const res = await fetch("./data.xlsx");
    if (!res.ok) {
      throw new Error("data.xlsxë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤");
    }

    const buf = await res.arrayBuffer();
    const { t60, t65 } = await parseXlsx(buf);

    tables["6.0"] = t60;
    tables["6.5"] = t65;

    setFileStatus(
      true,
      "data.xlsx",
      `ì‹œíŠ¸ "${SHEET_60}", "${SHEET_65}" Â· sph ${t60.sphList.length} Â· cyl ${t60.cylList.length}`
    );

    computeAndRender();
    toast("ì—‘ì…€ ìë™ ë¡œë“œ ì™„ë£Œ");
  } catch (e) {
    console.error(e);
    setFileStatus(false, "ì—‘ì…€ ìë™ ë¡œë“œ ì‹¤íŒ¨", String(e.message || e));
    badgeNA();
    ui.hintLine.textContent = "ì„œë²„ì˜ data.xlsxë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";
  }
}
  </script>
</body>
</html>
